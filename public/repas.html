<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Repas</title>
  </head>
  <body>
    <h2>Gérer ses repas</h2>
    <div id="contenu"></div>

    <table id="tableau_repas">
      <thead>
        <tr>
          <th id="thDate">Date du repas</th>
          <th id="thInvites">Nombre invités</th>
          <th id="thRecettes">Recettes</th>
        </tr>
      </thead>
    </table>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.1/axios.min.js"></script>

    <script>
      var tableau = document.querySelector("#tableau_repas");
      var tBody = document.createElement("tbody");

      //On récupère les repas et on les insère dans le tableau :
      axios.get("/api/repas").then((response) => {
        console.log(response.data);

        async();
        //Insérer les dates :
        response.data.forEach((element, index) => {
          var tr = document.createElement("tr");
          var btnModifier = document.createElement("button");
          var btnSupprimer = document.createElement("button");
          //here newest :
          /*var casesDuTableau = [
            (tdDate = document.createElement("td")),
            // tdDate.setAttribute('id', 'tdDate'+index)
            (tdInvites = document.createElement("td")),
            (tdRecettes = document.createElement("td")),
            (btnModifier = document.createElement("button")),
            (btnSupprimer = document.createElement("button")),
          ];

          casesDuTableau.forEach((element, index) => {
            tr.appendChild(element);
          });
          tBody.appendChild(tr);
          tableau.appendChild(tBody);
          */
          //On insère le date :
          var tdDate = document.createElement("td");

          tdDate.innerHTML = element.Date_repas;
          tr.appendChild(tdDate);

          //Et ensuite les invitées :
          var tdInvites = document.createElement("td");
          tdInvites.innerHTML = element.Invites;
          tr.appendChild(tdInvites);

          console.log(element.id_repas);
          //On récupère les recettes de chaque repas et on les ajoute dans le tableau :
          var tdRecettes = document.createElement("td");
          axios
            .get("/api/repas&recettes/" + element.id_repas)
            .then((response) => {
              response.data.forEach((recette) => {
                var pRecette = document.createElement("p");
                pRecette.innerHTML = recette.Nom;
                tdRecettes.appendChild(pRecette);
                tr.appendChild(tdRecettes);
                // tBody.appendChild(tr);
                // tableau.appendChild(tBody);
              });
            });

          tr.appendChild(tdRecettes);
          tr.appendChild(btnModifier);
          tr.appendChild(btnSupprimer);

          tBody.appendChild(tr);
          tableau.appendChild(tBody);
        });
      });

      // var newP = document.createElement("div");
      // var newContent = document.createTextNode("Hi there and greetings!");

      // newP.appendChild(newContent);
      // document.body.insertBefore(newP, contenu);
    </script>
  </body>
</html>
