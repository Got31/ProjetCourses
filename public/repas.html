<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>Repas</title>
  </head>
  <body>
    <h2>Gérer ses repas</h2>
    <div id="contenu"></div>

    <table class="tableau" id="tableau_repas">
      <thead>
        <tr>
          <th id="thDate">Date du repas</th>
          <th id="thInvites">Nombre invités</th>
          <th id="thRecettes">Recettes</th>
        </tr>
      </thead>
      <button id="btn-liste_course">Génerer la liste de course</button>
    </table>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.1/axios.min.js"></script>

    <script>
            var tableau = document.querySelector("#tableau_repas");
            var tBody = document.createElement("tbody");

            //On récupère les repas et on les insère dans le tableau :
            axios.get("/api/repas").then((response) => {
              console.log(response.data);

              response.data.forEach((element, index) => {
                //************ here :
                /*var hiddenKey = document.createElement("input");
                hiddenKey.setAttribute("type", "hidden");*/

                var tr = document.createElement("tr");

                var btnModifier = document.createElement("button");
                btnModifier.innerHTML = "modifier";

                var btnSupprimer = document.createElement("button");
                btnSupprimer.innerHTML = "supprimer";
                btnSupprimer.addEventListener("click", (event) => {
                  axios.delete("/api/repas/" + element.id_repas).then((response) => {
                    console.log(response);
                    location.reload();
                  });
                });

                var tdButton = document.createElement("td");
                tdButton.appendChild(btnModifier);
                tdButton.appendChild(btnSupprimer);

                //On insère la date :
                var tdDate = document.createElement("td");

                tdDate.innerHTML = element.Date_repas;
                tr.appendChild(tdDate);

                //Et ensuite les invitées :
                var tdInvites = document.createElement("td");
                tdInvites.innerHTML = element.Invites;
                tr.appendChild(tdInvites);

                console.log(element.id_repas);
                //On récupère les recettes de chaque repas et on les ajoute dans le tableau :
                var tdRecettes = document.createElement("td");
                console.log("B");
                tr.appendChild(tdRecettes);
                tr.appendChild(tdButton);
                tBody.appendChild(tr);
                tableau.appendChild(tBody);
                axios
                  .get("/api/repas&recettes/" + element.id_repas)
                  .then((response) => {
                    console.log("A");
                    response.data.forEach((recette) => {
                      var pRecette = document.createElement("p");
                      pRecette.innerHTML = recette.Nom;
                      tdRecettes.appendChild(pRecette);
                    });
                  });
              });
            });

            var btnListeCourse = document.getElementById("btn-liste_course");
            btnListeCourse.addEventListener("click", () => {
              //génerer la liste des ingrédients avec leur quatité et leur prix :
              /*récuperation des ingrédients avec leur quantité et leur prix;
              multipliser la quantité par le nombre d'invités:
                additionner les nombres d'invités de la semaine;
                multiplier la quantité d'un ingrédient par ce nombre;
            });

            /* Fonction modifier :
      récuperer les éléments de la ligne en question,
      créer des champs de type input et y insérer la valeur des éléments :
            date : type 'date'
            nombre d'invité : type 'nombre'
            recetees : type  */

            /* Fonction suppression :
      récupérer l'id du repas et créer une requête de suppresion.
      */
    </script>
  </body>
</html>
